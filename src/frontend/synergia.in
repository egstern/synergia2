#!/bin/sh

if [ -z "$1" ]; then
    echo "usage: $0 <synergia_script> [arguments]" >&2
    exit 1
fi
if [ "$1" = "--help" ]; then
    echo "usage: $0 <synergia_script> [arguments]"
    exit 0
fi

local_dir="${SYNERGIA2_BINARY_DIR}"
SYNERGIA2DIR="$local_dir"
export SYNERGIA2DIR
install_dir="${CMAKE_INSTALL_PREFIX}"
# the next section is a hack
. "$install_dir/../setup.sh"
install_python_dir="`find $install_dir -type d -name site-packages`"
# end hack
chef_dirs=`echo "${CHEF_LIBRARY_DIRS}" | sed 's/;/ /g'`
impact_dir="$local_dir/../impact/Forthon_Interfaces"
for dir in $local_dir $chef_dirs $impact_dir $install_python_dir
do
    PYTHONPATH="$dir:$PYTHONPATH"
done
export PYTHONPATH

if [ x"$1" = x"--pythonpath" ]; then
	echo "$PYTHONPATH"
	exit 0
fi

if [ x"$1" = x"--ldlibrarypath" ]; then
	echo "$LD_LIBRARY_PATH"
	exit 0
fi

just_options=false
options_file="`basename \"$1\" .py 2> /dev/null`_options.py"
if [ -f "$options_file" ]; then
	for arg in "$@"
	do
		if [ x"$arg" = x"--help" ]; then
			just_options=true
		fi
		if [ x"$arg" = x"createjob=1" ]; then
			just_options=true
		fi		
	done
fi

if [ "$just_options" = "true" ]; then
	exec "${PYTHON_EXECUTABLE}" "$options_file" --strip-options-file "$@"
else
	exec "${PYTHON_EXECUTABLE}" "$@"
fi
